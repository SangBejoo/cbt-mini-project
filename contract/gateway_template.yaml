type: google.api.Service
config_version: 3

http:
  rules:
    # ==================================================
    # BASE SERVICE
    # ==================================================
    - selector: base.Base.HealthCheck
      get: /v1/health

    # ==================================================
    # AUTH SERVICE (Added for JWT Authentication)
    # ==================================================
    - selector: base.AuthService.Login
      post: /v1/auth/login
      body: "*"

    - selector: base.AuthService.RefreshToken
      post: /v1/auth/refresh
      body: "*"

    # ==================================================
    # TEST SESSION SERVICE (Student Flow - The Core)
    # ==================================================

    # 1. Start Exam (Create Session)
    - selector: base.TestSessionService.CreateTestSession
      post: /v1/test-sessions
      body: "*"

    # 2. Get Session Info (Resume)
    - selector: base.TestSessionService.GetTestSession
      get: /v1/test-sessions/{session_token}

    # 3. Get Questions (Fetch Soal) -> Critical - Single Question at a Time
    # nomor_urut is a query param: /v1/test-sessions/{token}/questions?nomor_urut=1
    - selector: base.TestSessionService.GetTestQuestions
      get: /v1/test-sessions/{session_token}/questions

    # 4. Submit Answer (Realtime)
    # Payload JSON body hanya perlu: { "nomor_urut": 1, "jawaban_dipilih": 1 }
    # session_token diambil dari URL
    - selector: base.TestSessionService.SubmitAnswer
      post: /v1/test-sessions/{session_token}/answers
      body: "*"

    # 4.5. Clear Answer (Batalkan Jawaban)
    - selector: base.TestSessionService.ClearAnswer
      post: /v1/test-sessions/{session_token}/clear-answer
      body: "*"

    # 5. Finish Exam
    - selector: base.TestSessionService.CompleteSession
      post: /v1/test-sessions/{session_token}/complete
      body: "*"

    # 6. Review Result
    - selector: base.TestSessionService.GetTestResult
      get: /v1/test-sessions/{session_token}/result

    # ==================================================
    # HISTORY SERVICE
    # ==================================================
    - selector: base.HistoryService.GetStudentHistory
      get: /v1/history

    - selector: base.HistoryService.GetHistoryDetail
      get: /v1/history/{session_token}/detail

  