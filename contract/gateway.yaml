type: google.api.Service
config_version: 3

http:
  rules:
    # ==================================================
    # BASE SERVICE
    # ==================================================
    - selector: base.Base.HealthCheck
      get: /v1/health

    # ==================================================
    # AUTH SERVICE (Added for JWT Authentication)
    # ==================================================
    - selector: base.AuthService.Login
      post: /v1/auth/login
      body: "*"
    - selector: base.AuthService.GetProfile
      get: /v1/auth/profile

    # ==================================================
    # TEST SESSION SERVICE (Admin)
    # ==================================================
    - selector: base.TestSessionService.ListTestSessions
      get: /v1/admin/sessions

    # 1. Start Exam (Create Session)
    - selector: base.TestSessionService.CreateTestSession
      post: /v1/test-sessions
      body: "*"

    # 2. Get Session Info (Resume)
    - selector: base.TestSessionService.GetTestSession
      get: /v1/test-sessions/{session_token}

    # 3. Get Questions (Fetch Soal) -> Critical - Single Question at a Time
    # nomor_urut is a query param: /v1/test-sessions/{token}/questions?nomor_urut=1
    - selector: base.TestSessionService.GetTestQuestions
      get: /v1/test-sessions/{session_token}/questions

    # 4. Submit Answer (Realtime)
    # Payload JSON body hanya perlu: { "nomor_urut": 1, "jawaban_dipilih": 1 }
    # session_token diambil dari URL
    - selector: base.TestSessionService.SubmitAnswer
      post: /v1/test-sessions/{session_token}/answers
      body: "*"

    # 4.4. Submit Drag-Drop Answer
    - selector: base.TestSessionService.SubmitDragDropAnswer
      post: /v1/test-sessions/{session_token}/drag-drop-answers
      body: "*"

    # 4.5. Clear Answer (Batalkan Jawaban)
    - selector: base.TestSessionService.ClearAnswer
      post: /v1/test-sessions/{session_token}/clear-answer
      body: "*"

    # 5. Finish Exam
    - selector: base.TestSessionService.CompleteSession
      post: /v1/test-sessions/{session_token}/complete
      body: "*"

    # 6. Review Result
    - selector: base.TestSessionService.GetTestResult
      get: /v1/test-sessions/{session_token}/result

    # ==================================================
    # HISTORY SERVICE
    # ==================================================
    - selector: base.HistoryService.GetStudentHistory
      get: /v1/history

    # Alias for student history
    - selector: base.HistoryService.GetStudentHistory
      get: /v1/history/student

    - selector: base.HistoryService.GetHistoryDetail
      get: /v1/history/{session_token}/detail

    # ==================================================
    # MATA PELAJARAN SERVICE (Read-only)
    # ==================================================
    - selector: base.MataPelajaranService.GetMataPelajaran
      get: /v1/mata-pelajaran/{id}

    - selector: base.MataPelajaranService.ListMataPelajaran
      get: /v1/mata-pelajaran

    # Alias for topics (mata pelajaran)
    - selector: base.MataPelajaranService.ListMataPelajaran
      get: /v1/topics

    # Alias for subjects (mata pelajaran)
    - selector: base.MataPelajaranService.ListMataPelajaran
      get: /v1/subjects
    # ==================================================
    # MATERI SERVICE
    # ==================================================
    - selector: base.MateriService.CreateMateri
      post: /v1/materi
      body: "*"

    - selector: base.MateriService.GetMateri
      get: /v1/materi/{id}

    - selector: base.MateriService.UpdateMateri
      put: /v1/materi/{id}
      body: "*"

    - selector: base.MateriService.DeleteMateri
      delete: /v1/materi/{id}

    - selector: base.MateriService.ListMateri
      get: /v1/materi

    # ==================================================
    # TINGKAT SERVICE (Read-only)
    # ==================================================
    - selector: base.TingkatService.GetTingkat
      get: /v1/tingkat/{id}

    - selector: base.TingkatService.ListTingkat
      get: /v1/tingkat

    # Alias for levels (tingkat)
    - selector: base.TingkatService.ListTingkat
      get: /v1/levels

    # ==================================================
    # SOAL SERVICE (Admin)
    # ==================================================
    - selector: base.SoalService.CreateSoal
      post: /v1/soal
      body: "*"

    - selector: base.SoalService.GetSoal
      get: /v1/soal/{id}

    - selector: base.SoalService.UpdateSoal
      put: /v1/soal/{id}
      body: "*"

    - selector: base.SoalService.DeleteSoal
      delete: /v1/soal/{id}

    - selector: base.SoalService.ListSoal
      get: /v1/soal

    # Alias for questions (soal)
    - selector: base.SoalService.ListSoal
      get: /v1/questions

    # Aliases for questions CRUD (frontend uses /questions)
    - selector: base.SoalService.CreateSoal
      post: /v1/questions
      body: "*"

    - selector: base.SoalService.GetSoal
      get: /v1/questions/{id}

    - selector: base.SoalService.UpdateSoal
      put: /v1/questions/{id}
      body: "*"

    - selector: base.SoalService.DeleteSoal
      delete: /v1/questions/{id}

    - selector: base.SoalService.UploadImageToSoal
      post: /v1/questions/{id_soal}/images
      body: "*"

    - selector: base.SoalService.DeleteImageFromSoal
      delete: /v1/questions/images/{id_gambar}

    - selector: base.SoalService.UpdateImageInSoal
      put: /v1/questions/images/{id_gambar}
      body: "*"

    - selector: base.SoalService.GetQuestionCountsByTopic
      get: /v1/question-counts

    # ==================================================
    # SOAL DRAG DROP SERVICE (Admin)
    # ==================================================
    - selector: base.SoalDragDropService.CreateSoalDragDrop
      post: /v1/soal-drag-drop
      body: "*"

    - selector: base.SoalDragDropService.GetSoalDragDrop
      get: /v1/soal-drag-drop/{id}

    - selector: base.SoalDragDropService.UpdateSoalDragDrop
      put: /v1/soal-drag-drop/{id}
      body: "*"

    - selector: base.SoalDragDropService.DeleteSoalDragDrop
      delete: /v1/soal-drag-drop/{id}

    - selector: base.SoalDragDropService.ListSoalDragDrop
      get: /v1/soal-drag-drop
  